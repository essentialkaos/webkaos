################################################################################
#                          WEBKAOS DEFAULT CONFIG FILE                         #
################################################################################
#                                                                              #
# Please note what it's a DEFAULT configuration file. This is appropriate for  #
# most cases, but not for all. Check all configuration values before webkaos   #
# usage.                                                                       #
#                                                                              #
# More information about pagespeed configuration you may find on this page:    #
# https://developers.google.com/speed/pagespeed/                               #
#                                                                              #
################################################################################

user  webkaos;

worker_processes      auto;
worker_rlimit_nofile  8192;
worker_priority       -1;

################################################################################

error_log  /var/log/webkaos/error.log warn;
pid        /var/run/webkaos.pid;

################################################################################

events {
  worker_connections  8000;
}

################################################################################

http {
  
  server_tokens  off;

  ##############################################################################

  include       /etc/webkaos/mime.types;
  default_type  application/octet-stream;

  log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

  log_format  upsteram  '$remote_addr - [$time_local] "$request" '
                        '$status $body_bytes_sent '
                        '"$http_x_forwarded_for" "$http_referer"  $host '
                        '$request_time $upstream_response_time '
                        '$upstream_addr - $upstream_status ';

  access_log  /var/log/webkaos/access.log  main;

  sendfile              on;
  tcp_nopush            on;
  tcp_nodelay           off;
  ssi                   off;

  client_body_timeout   15;
  client_header_timeout 15;
  keepalive_timeout     30;
  send_timeout          15;

  server_names_hash_max_size    1024;
  server_names_hash_bucket_size {BUCKET_SIZE};

  ##############################################################################

  gzip               on;
  gzip_http_version  1.0;
  gzip_comp_level    5;
  gzip_min_length    256;
  gzip_proxied       any;
  gzip_vary          on;
  gzip_proxied       expired no-cache no-store private auth;
  gzip_disable       "MSIE [1-6]\.";
  gzip_types
    application/atom+xml
    application/javascript
    application/json
    application/rss+xml
    application/vnd.ms-fontobject
    application/x-font-ttf
    application/x-web-app-manifest+json
    application/xhtml+xml
    application/xml
    font/opentype
    image/svg+xml
    image/x-icon
    text/css
    text/plain
    text/x-component;

  ##############################################################################

  ssl_ciphers                ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4;
  ssl_session_cache          shared:SSL:30m;
  ssl_session_timeout        5m;
  ssl_prefer_server_ciphers  on;
  ssl_protocols              TLSv1 TLSv1.1 TLSv1.2;
  ssl_dhparam                /etc/webkaos/ssl/dhparam.pem;

  ssl_stapling               on;
  ssl_stapling_verify        on;
  resolver                   8.8.4.4 8.8.8.8 valid=300s;
  resolver_timeout           10s;

  ##############################################################################
  
  # Main configuration for pagespeed. Pagespeed globally disabled, include
  # xtra/pagespeed_enabled.conf in your server block to enable pagespeed.
  include xtra/pagespeed.conf;

  ##############################################################################

  server {
    listen         80 default_server;
    server_name    _;

    location / {
      root /usr/share/webkaos/html;
    }
  }

  ##############################################################################

  include conf.d/*.conf;
}

################################################################################
